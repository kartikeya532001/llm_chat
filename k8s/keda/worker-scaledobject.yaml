apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: llm-worker-scaledobject
  namespace: app
spec:
  scaleTargetRef:
    name: llm-worker-spot
  pollingInterval: 5
  cooldownPeriod: 30
  minReplicaCount: 0
  maxReplicaCount: 3
  advanced:
    restoreToOriginalReplicaCount: false

  triggers:
    # High priority queue: scale aggressively
    - type: redis
      metadata:
        address: redis.app.svc.cluster.local:6379
        listName: queue:high
        listLength: "1"            # scale when even 1 job is in high queue
        activationThreshold: "1"   # ensures scaling starts immediately
    # Normal priority queue: scale only if backlog is bigger
    - type: redis
      metadata:
        address: redis.app.svc.cluster.local:6379
        listName: queue:normal
        listLength: "5"            # scale when backlog > 5
        activationThreshold: "5"   # ensures small queues donâ€™t trigger scaling
